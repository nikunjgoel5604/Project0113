<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nikunj Data Analyzer</title>

    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        /* ============================================================
           DESIGN SYSTEM ‚Äî Industrial Data Terminal Aesthetic
           ============================================================ */
        :root {
            --bg:        #0d0f14;
            --surface:   #131720;
            --surface2:  #1a2030;
            --border:    #252d3d;
            --accent:    #00e5ff;
            --accent2:   #7c4dff;
            --accent3:   #ff6b35;
            --green:     #00e676;
            --yellow:    #ffd740;
            --red:       #ff5252;
            --text:      #e8eaf6;
            --text-dim:  #7986a3;
            --font-mono: 'Space Mono', monospace;
            --font-body: 'DM Sans', sans-serif;
            --radius:    6px;
            --glow:      0 0 20px rgba(0,229,255,0.15);
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-body);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* Scanline overlay */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.03) 2px,
                rgba(0,0,0,0.03) 4px
            );
            pointer-events: none;
            z-index: 9999;
        }

        /* ===== LAYOUT ===== */
        .shell {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 28px 0;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar-logo {
            padding: 0 20px 28px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-logo h1 {
            font-family: var(--font-mono);
            font-size: 14px;
            color: var(--accent);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .sidebar-logo p {
            font-size: 11px;
            color: var(--text-dim);
            margin-top: 4px;
        }

        .nav-section {
            padding: 20px 12px 0;
        }

        .nav-label {
            font-family: var(--font-mono);
            font-size: 10px;
            letter-spacing: 2px;
            color: var(--text-dim);
            text-transform: uppercase;
            padding: 0 8px;
            margin-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 9px 12px;
            border-radius: var(--radius);
            font-size: 13px;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            border: 1px solid transparent;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(0,229,255,0.07);
            border-color: rgba(0,229,255,0.2);
            color: var(--accent);
        }

        .nav-item .icon { font-size: 15px; }

        /* ===== MAIN ===== */
        .main {
            padding: 32px;
            max-width: 1300px;
        }

        /* ===== SECTIONS ===== */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* ===== PAGE HEADER ===== */
        .page-header {
            margin-bottom: 28px;
        }

        .page-header h2 {
            font-family: var(--font-mono);
            font-size: 18px;
            color: var(--text);
            letter-spacing: 1px;
        }

        .page-header p {
            font-size: 13px;
            color: var(--text-dim);
            margin-top: 4px;
        }

        /* ===== CARD ===== */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 22px;
            margin-bottom: 20px;
        }

        .card-title {
            font-family: var(--font-mono);
            font-size: 11px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        /* ===== UPLOAD ZONE ===== */
        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .upload-zone:hover,
        .upload-zone.drag-over {
            border-color: var(--accent);
            background: rgba(0,229,255,0.04);
            box-shadow: var(--glow);
        }

        .upload-zone input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .upload-zone h3 {
            font-family: var(--font-mono);
            font-size: 14px;
            color: var(--text);
            margin-bottom: 6px;
        }

        .upload-zone p {
            font-size: 12px;
            color: var(--text-dim);
        }

        .upload-zone .formats {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 16px;
        }

        .badge {
            font-family: var(--font-mono);
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 3px;
            border: 1px solid var(--border);
            color: var(--text-dim);
        }

        .badge.active {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* ===== BTN ===== */
        .btn {
            font-family: var(--font-mono);
            font-size: 12px;
            letter-spacing: 1px;
            padding: 10px 22px;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            transition: all 0.15s;
            text-transform: uppercase;
        }

        .btn-primary {
            background: var(--accent);
            color: #000;
        }

        .btn-primary:hover {
            box-shadow: 0 0 20px rgba(0,229,255,0.4);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
        }

        .btn-outline:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* ===== STAT GRID ===== */
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 14px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 18px;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
        }

        .stat-card.warn::before { background: var(--yellow); }
        .stat-card.danger::before { background: var(--red); }
        .stat-card.success::before { background: var(--green); }

        .stat-label {
            font-family: var(--font-mono);
            font-size: 10px;
            letter-spacing: 1px;
            color: var(--text-dim);
            text-transform: uppercase;
        }

        .stat-value {
            font-family: var(--font-mono);
            font-size: 28px;
            color: var(--text);
            margin-top: 6px;
        }

        .stat-sub {
            font-size: 11px;
            color: var(--text-dim);
            margin-top: 2px;
        }

        /* ===== TABLE ===== */
        .tbl-wrap {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        thead th {
            background: var(--surface2);
            font-family: var(--font-mono);
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--accent);
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        tbody td {
            padding: 9px 12px;
            border-bottom: 1px solid rgba(37,45,61,0.6);
            color: var(--text-dim);
            font-size: 12px;
        }

        tbody tr:hover td {
            background: rgba(0,229,255,0.03);
            color: var(--text);
        }

        /* ===== PRE ===== */
        pre {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-dim);
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            overflow-x: auto;
            line-height: 1.7;
        }

        /* ===== CHART BOX ===== */
        .chart-container {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            position: relative;
        }

        .chart-title-label {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-dim);
            margin-bottom: 12px;
        }

        /* ===== CHART BUILDER ===== */
        .chart-builder-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr) auto;
            gap: 14px;
            align-items: end;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-label {
            font-family: var(--font-mono);
            font-size: 10px;
            letter-spacing: 1px;
            color: var(--text-dim);
            text-transform: uppercase;
        }

        select, input[type="text"] {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text);
            padding: 9px 12px;
            font-family: var(--font-body);
            font-size: 13px;
            width: 100%;
            transition: border-color 0.15s;
            -webkit-appearance: none;
        }

        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* ===== CHART TYPE PILLS ===== */
        .chart-type-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .chart-pill {
            font-family: var(--font-mono);
            font-size: 11px;
            padding: 7px 14px;
            border-radius: 20px;
            border: 1px solid var(--border);
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.15s;
            background: transparent;
        }

        .chart-pill:hover {
            border-color: var(--accent2);
            color: var(--accent2);
        }

        .chart-pill.active {
            background: var(--accent2);
            border-color: var(--accent2);
            color: #fff;
        }

        /* ===== MISSING BAR ===== */
        .missing-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 12px;
        }

        .missing-col-name {
            width: 160px;
            color: var(--text-dim);
            font-family: var(--font-mono);
            font-size: 11px;
            flex-shrink: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .missing-bar-track {
            flex: 1;
            height: 8px;
            background: var(--surface2);
            border-radius: 4px;
            overflow: hidden;
        }

        .missing-bar-fill {
            height: 100%;
            background: var(--red);
            border-radius: 4px;
            transition: width 0.6s ease;
        }

        .missing-pct {
            width: 40px;
            text-align: right;
            color: var(--red);
            font-family: var(--font-mono);
            font-size: 11px;
        }

        /* ===== INSIGHTS ===== */
        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
            color: var(--text-dim);
        }

        .insight-item:last-child { border-bottom: none; }

        .insight-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent);
            margin-top: 5px;
            flex-shrink: 0;
        }

        /* ===== PROGRESS BAR ===== */
        .progress-wrap {
            background: var(--surface2);
            border-radius: 4px;
            height: 6px;
            overflow: hidden;
            margin-top: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent2), var(--accent));
            border-radius: 4px;
            transition: width 0.6s ease;
        }

        /* ===== TOAST ===== */
        #toast {
            position: fixed;
            bottom: 28px;
            right: 28px;
            background: var(--surface);
            border: 1px solid var(--accent);
            color: var(--accent);
            font-family: var(--font-mono);
            font-size: 12px;
            padding: 12px 20px;
            border-radius: var(--radius);
            box-shadow: var(--glow);
            z-index: 10000;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(40px); opacity: 0; }
            to   { transform: translateX(0);    opacity: 1; }
        }

        /* ===== SPINNER ===== */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0,229,255,0.2);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1000px) {
            .shell { grid-template-columns: 1fr; }
            .sidebar { display: none; }
            .stat-grid { grid-template-columns: repeat(2, 1fr); }
            .chart-builder-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>

<body>

<div id="toast"></div>

<div class="shell">

    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <h1>// DataAnalyzer</h1>
            <p>Nikunj EDA Platform v2.0</p>
        </div>

        <div class="nav-section">
            <div class="nav-label">Upload</div>
            <a class="nav-item active" data-section="upload" onclick="showSection('upload')">
                <span class="icon">üìÅ</span> Upload File
            </a>
        </div>

        <div class="nav-section">
            <div class="nav-label">Analysis</div>
            <a class="nav-item" data-section="overview" onclick="showSection('overview')">
                <span class="icon">üìä</span> Overview
            </a>
            <a class="nav-item" data-section="quality" onclick="showSection('quality')">
                <span class="icon">üîç</span> Data Quality
            </a>
            <a class="nav-item" data-section="structure" onclick="showSection('structure')">
                <span class="icon">üóÇÔ∏è</span> Structure
            </a>
            <a class="nav-item" data-section="values" onclick="showSection('values')">
                <span class="icon">üìã</span> Value Counts
            </a>
        </div>

        <div class="nav-section">
            <div class="nav-label">Visualization</div>
            <a class="nav-item" data-section="charts" onclick="showSection('charts')">
                <span class="icon">üìà</span> Chart Builder
            </a>
            <a class="nav-item" data-section="correlation" onclick="showSection('correlation')">
                <span class="icon">üîó</span> Correlation
            </a>
        </div>

        <div class="nav-section">
            <div class="nav-label">Output</div>
            <a class="nav-item" data-section="insights" onclick="showSection('insights')">
                <span class="icon">üí°</span> Insights
            </a>
            <a class="nav-item" data-section="preview" onclick="showSection('preview')">
                <span class="icon">üëÅÔ∏è</span> Data Preview
            </a>
        </div>
    </aside>

    <!-- ===== MAIN ===== -->
    <main class="main">

        <!-- =========== UPLOAD =========== -->
        <section id="section-upload" class="section active">
            <div class="page-header">
                <h2>// UPLOAD_DATASET</h2>
                <p>Upload a CSV or Excel file to begin analysis</p>
            </div>

            <div class="card">
                <div class="card-title">File Input</div>
                <div class="upload-zone" id="dropZone">
                    <input type="file" id="fileInput" accept=".csv,.xlsx,.xls">
                    <div class="upload-icon">‚¨Ü</div>
                    <h3>Drop file here or click to browse</h3>
                    <p>Supported formats shown below</p>
                    <div class="formats">
                        <span class="badge active">CSV</span>
                        <span class="badge active">XLSX</span>
                        <span class="badge active">XLS</span>
                        <span class="badge">XML (soon)</span>
                        <span class="badge">JSON (soon)</span>
                    </div>
                </div>

                <div style="margin-top:16px; display:flex; gap:12px; align-items:center;">
                    <button class="btn btn-primary" id="uploadBtn">
                        <span id="uploadBtnText">RUN ANALYSIS</span>
                    </button>
                    <span id="fileName" style="font-size:13px; color:var(--text-dim); font-family:var(--font-mono);"></span>
                </div>
            </div>

            <div class="card" id="uploadStatus" style="display:none;">
                <div class="card-title">Processing Log</div>
                <pre id="statusLog"></pre>
            </div>
        </section>


        <!-- =========== OVERVIEW =========== -->
        <section id="section-overview" class="section">
            <div class="page-header">
                <h2>// DATASET_OVERVIEW</h2>
                <p>Shape, types, and structural summary</p>
            </div>

            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Rows</div>
                    <div class="stat-value" id="s-rows">‚Äî</div>
                    <div class="stat-sub">Records</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Columns</div>
                    <div class="stat-value" id="s-cols">‚Äî</div>
                    <div class="stat-sub">Features</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-label">Numeric Cols</div>
                    <div class="stat-value" id="s-num">‚Äî</div>
                    <div class="stat-sub" id="s-num-names" style="font-size:10px;"></div>
                </div>
                <div class="stat-card warn">
                    <div class="stat-label">Categorical Cols</div>
                    <div class="stat-value" id="s-cat">‚Äî</div>
                    <div class="stat-sub" id="s-cat-names" style="font-size:10px;"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Column Overview</div>
                <div class="tbl-wrap">
                    <table id="colOverviewTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Unique Values</th>
                                <th>Missing</th>
                                <th>Missing %</th>
                                <th>Coverage</th>
                            </tr>
                        </thead>
                        <tbody id="colOverviewBody"></tbody>
                    </table>
                </div>
            </div>
        </section>


        <!-- =========== DATA QUALITY =========== -->
        <section id="section-quality" class="section">
            <div class="page-header">
                <h2>// DATA_QUALITY</h2>
                <p>Missing values, duplicates, and cleaning report</p>
            </div>

            <div class="stat-grid" style="grid-template-columns:repeat(2,1fr)">
                <div class="stat-card danger">
                    <div class="stat-label">Duplicate Rows</div>
                    <div class="stat-value" id="q-dupes">‚Äî</div>
                    <div class="stat-sub">Exact duplicate records</div>
                </div>
                <div class="stat-card warn">
                    <div class="stat-label">Columns with Missing</div>
                    <div class="stat-value" id="q-missing-cols">‚Äî</div>
                    <div class="stat-sub">Columns affected</div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Missing Value Analysis</div>
                <div id="missingBars"></div>
            </div>

            <div class="card">
                <div class="card-title">Cleaning Report</div>
                <div class="tbl-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>Column</th>
                                <th>Missing Before</th>
                                <th>Missing After</th>
                                <th>Method Applied</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="cleaningBody"></tbody>
                    </table>
                </div>
            </div>
        </section>


        <!-- =========== STRUCTURE =========== -->
        <section id="section-structure" class="section">
            <div class="page-header">
                <h2>// DATASET_STRUCTURE</h2>
                <p>df.info(), dtypes, and unique value counts</p>
            </div>

            <div class="card">
                <div class="card-title">df.info() Output</div>
                <pre id="dfInfo"></pre>
            </div>

            <div class="card">
                <div class="card-title">df.nunique() ‚Äî Unique Value Counts</div>
                <div class="tbl-wrap">
                    <table>
                        <thead>
                            <tr><th>Column</th><th>Unique Count</th><th>Cardinality</th></tr>
                        </thead>
                        <tbody id="nuniqBody"></tbody>
                    </table>
                </div>
            </div>
        </section>


        <!-- =========== VALUE COUNTS =========== -->
        <section id="section-values" class="section">
            <div class="page-header">
                <h2>// VALUE_COUNTS</h2>
                <p>Frequency distribution of categorical columns</p>
            </div>

            <div class="form-group" style="max-width:280px; margin-bottom:20px;">
                <label class="form-label">Select Column</label>
                <select id="vcColSelect"></select>
            </div>

            <div class="card">
                <div class="card-title" id="vcTitle">Value Distribution</div>
                <div class="tbl-wrap">
                    <table>
                        <thead>
                            <tr><th>Value</th><th>Count</th><th>Proportion</th></tr>
                        </thead>
                        <tbody id="vcBody"></tbody>
                    </table>
                </div>
            </div>
        </section>


        <!-- =========== CHARTS =========== -->
        <section id="section-charts" class="section">
            <div class="page-header">
                <h2>// CHART_BUILDER</h2>
                <p>Interactive visualization engine</p>
            </div>

            <div class="card">
                <div class="card-title">Chart Configuration</div>

                <div class="form-group" style="margin-bottom:16px;">
                    <label class="form-label">Chart Type</label>
                    <div class="chart-type-grid">
                        <button class="chart-pill active" data-type="bar">Bar Chart</button>
                        <button class="chart-pill" data-type="line">Line Chart</button>
                        <button class="chart-pill" data-type="pie">Pie / Donut</button>
                        <button class="chart-pill" data-type="scatter">Scatter Plot</button>
                        <button class="chart-pill" data-type="histogram">Histogram</button>
                        <button class="chart-pill" data-type="doughnut">Doughnut</button>
                        <button class="chart-pill" data-type="radar">Radar</button>
                    </div>
                </div>

                <div class="chart-builder-grid">
                    <div class="form-group">
                        <label class="form-label">Chart Title</label>
                        <input type="text" id="chartTitle" placeholder="My Chart">
                    </div>
                    <div class="form-group">
                        <label class="form-label">X Axis Column</label>
                        <select id="xAxisCol"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Y Axis Column</label>
                        <select id="yAxisCol">
                            <option value="count">Count (auto)</option>
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-primary" id="buildChartBtn">RENDER</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title" id="chartDisplayTitle">Chart Output</div>
                <div class="chart-container" style="height:420px;">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>
        </section>


        <!-- =========== CORRELATION =========== -->
        <section id="section-correlation" class="section">
            <div class="page-header">
                <h2>// CORRELATION_ANALYSIS</h2>
                <p>Pearson correlation between numeric columns</p>
            </div>

            <div class="card">
                <div class="card-title">Correlation Table</div>
                <div class="tbl-wrap">
                    <div id="correlationTable"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Correlation Bar Chart</div>
                <div class="chart-container" style="height:320px;">
                    <canvas id="corrChart"></canvas>
                </div>
            </div>
        </section>


        <!-- =========== INSIGHTS =========== -->
        <section id="section-insights" class="section">
            <div class="page-header">
                <h2>// AUTO_INSIGHTS</h2>
                <p>Key findings from the dataset</p>
            </div>

            <div class="card">
                <div class="card-title">Generated Insights</div>
                <div id="insightsBox"></div>
            </div>
        </section>


        <!-- =========== PREVIEW =========== -->
        <section id="section-preview" class="section">
            <div class="page-header">
                <h2>// DATA_PREVIEW</h2>
                <p>First 10 rows ‚Äî df.head(10)</p>
            </div>

            <div class="card">
                <div class="card-title">Dataset Head</div>
                <div class="tbl-wrap">
                    <div id="previewTable"></div>
                </div>
            </div>
        </section>

    </main>
</div>

<script>
// =====================================================
//  GLOBAL STATE
// =====================================================
let G = null;          // global dataset response
let mainChart = null;
let corrChart  = null;
let activeChartType = 'bar';

// =====================================================
//  NAVIGATION
// =====================================================
function showSection(name) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

    const sec = document.getElementById('section-' + name);
    if (sec) sec.classList.add('active');

    const navItem = document.querySelector(`[data-section="${name}"]`);
    if (navItem) navItem.classList.add('active');
}

// =====================================================
//  CHART TYPE PILLS
// =====================================================
document.querySelectorAll('.chart-pill').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.chart-pill').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        activeChartType = btn.dataset.type;
    });
});

// =====================================================
//  DRAG AND DROP
// =====================================================
const dropZone = document.getElementById('dropZone');

dropZone.addEventListener('dragover', e => {
    e.preventDefault();
    dropZone.classList.add('drag-over');
});

dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));

dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    const f = e.dataTransfer.files[0];
    if (f) {
        document.getElementById('fileInput').files = e.dataTransfer.files;
        document.getElementById('fileName').textContent = '‚Üí ' + f.name;
    }
});

document.getElementById('fileInput').addEventListener('change', e => {
    const f = e.target.files[0];
    if (f) document.getElementById('fileName').textContent = '‚Üí ' + f.name;
});

// =====================================================
//  TOAST
// =====================================================
function toast(msg, duration = 3000) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.style.display = 'block';
    setTimeout(() => t.style.display = 'none', duration);
}

// =====================================================
//  UPLOAD & PROCESS
// =====================================================
document.getElementById('uploadBtn').addEventListener('click', async () => {
    const file = document.getElementById('fileInput').files[0];
    if (!file) { toast('‚ö† SELECT A FILE FIRST'); return; }

    const btn = document.getElementById('uploadBtn');
    const btnText = document.getElementById('uploadBtnText');

    btn.disabled = true;
    btnText.innerHTML = '<span class="spinner"></span>';

    document.getElementById('uploadStatus').style.display = 'block';
    document.getElementById('statusLog').textContent =
        `[${ts()}] Uploading: ${file.name}\n[${ts()}] File size: ${(file.size/1024).toFixed(1)} KB\n[${ts()}] Running EDA pipeline...`;

    const fd = new FormData();
    fd.append('file', file);

    try {
        const res  = await fetch('/upload', { method: 'POST', body: fd });
        const data = await res.json();

        if (!res.ok || data.error) {
            document.getElementById('statusLog').textContent += `\n[${ts()}] ERROR: ${data.error}`;
            btn.disabled = false;
            btnText.textContent = 'RUN ANALYSIS';
            return;
        }

        G = data;
        document.getElementById('statusLog').textContent +=
            `\n[${ts()}] Done. Rows: ${data.overview.rows} | Cols: ${data.overview.columns}\n[${ts()}] Rendering dashboard...`;

        renderAll(data);

        btn.disabled = false;
        btnText.textContent = 'RUN ANALYSIS';

        toast('‚úî ANALYSIS COMPLETE');
        setTimeout(() => showSection('overview'), 800);

    } catch(err) {
        document.getElementById('statusLog').textContent += `\n[${ts()}] SERVER ERROR: ${err}`;
        btn.disabled = false;
        btnText.textContent = 'RUN ANALYSIS';
    }
});

function ts() {
    return new Date().toLocaleTimeString('en-GB');
}

// =====================================================
//  RENDER ALL SECTIONS
// =====================================================
function renderAll(d) {
    renderOverview(d);
    renderQuality(d);
    renderStructure(d);
    renderValueCounts(d);
    renderChartBuilder(d);
    renderCorrelation(d);
    renderInsights(d);
    renderPreview(d);
}

// =====================================================
//  OVERVIEW
// =====================================================
function renderOverview(d) {
    const ov = d.overview;
    document.getElementById('s-rows').textContent = ov.rows.toLocaleString();
    document.getElementById('s-cols').textContent = ov.columns;
    document.getElementById('s-num').textContent  = ov.numeric_columns.length;
    document.getElementById('s-cat').textContent  = ov.categorical_columns.length;
    document.getElementById('s-num-names').textContent = ov.numeric_columns.slice(0,4).join(', ') + (ov.numeric_columns.length > 4 ? '...' : '');
    document.getElementById('s-cat-names').textContent = ov.categorical_columns.slice(0,4).join(', ') + (ov.categorical_columns.length > 4 ? '...' : '');

    const tbody = document.getElementById('colOverviewBody');
    tbody.innerHTML = '';

    const mp = d.missing_handling_process;
    const nu = d.nunique;

    // Build col type map
    const typeMap = {};
    ov.numeric_columns.forEach(c => typeMap[c] = 'Numeric');
    ov.categorical_columns.forEach(c => typeMap[c] = 'Categorical');
    ov.datetime_columns.forEach(c => typeMap[c] = 'DateTime');

    const allCols = [...ov.numeric_columns, ...ov.categorical_columns, ...ov.datetime_columns];

    allCols.forEach((col, i) => {
        const mb   = mp[col]?.missing_before ?? 0;
        const pct  = ov.rows > 0 ? ((mb / ov.rows) * 100).toFixed(1) : 0;
        const cov  = (100 - pct).toFixed(1);
        const type = typeMap[col] || 'Unknown';

        tbody.innerHTML += `
            <tr>
                <td>${i + 1}</td>
                <td style="font-family:var(--font-mono);color:var(--accent);font-size:11px;">${col}</td>
                <td><span class="badge ${type === 'Numeric' ? 'active' : ''}">${type}</span></td>
                <td>${nu[col] ?? '‚Äî'}</td>
                <td style="color:${mb > 0 ? 'var(--red)' : 'var(--green)'}">${mb}</td>
                <td style="color:${mb > 0 ? 'var(--yellow)' : 'var(--text-dim)'}">${pct}%</td>
                <td>
                    <div class="progress-wrap" style="min-width:80px;">
                        <div class="progress-fill" style="width:${cov}%"></div>
                    </div>
                </td>
            </tr>
        `;
    });
}

// =====================================================
//  DATA QUALITY
// =====================================================
function renderQuality(d) {
    const mp = d.missing_handling_process;
    const dupes = d.data_quality?.duplicates ?? 0;

    document.getElementById('q-dupes').textContent = dupes;

    const missingCols = Object.entries(mp).filter(([,v]) => v.missing_before > 0);
    document.getElementById('q-missing-cols').textContent = missingCols.length;

    // Missing bars
    const barsDiv = document.getElementById('missingBars');
    barsDiv.innerHTML = '';

    const rows = d.overview.rows;
    const allCols = Object.entries(mp);

    if (allCols.every(([,v]) => v.missing_before === 0)) {
        barsDiv.innerHTML = '<p style="color:var(--green);font-family:var(--font-mono);font-size:13px;">‚úî No missing values found in dataset.</p>';
    } else {
        allCols.forEach(([col, val]) => {
            const pct = rows > 0 ? ((val.missing_before / rows) * 100).toFixed(1) : 0;
            if (val.missing_before === 0) return;
            barsDiv.innerHTML += `
                <div class="missing-row">
                    <div class="missing-col-name">${col}</div>
                    <div class="missing-bar-track">
                        <div class="missing-bar-fill" style="width:${Math.min(pct,100)}%"></div>
                    </div>
                    <div class="missing-pct">${pct}%</div>
                </div>
            `;
        });
    }

    // Cleaning table
    const tbody = document.getElementById('cleaningBody');
    tbody.innerHTML = '';
    allCols.forEach(([col, val]) => {
        const fixed = val.missing_before > val.missing_after;
        tbody.innerHTML += `
            <tr>
                <td style="font-family:var(--font-mono);font-size:11px;color:var(--accent)">${col}</td>
                <td style="color:${val.missing_before > 0 ? 'var(--red)' : 'var(--text-dim)'}">${val.missing_before}</td>
                <td style="color:${val.missing_after > 0 ? 'var(--yellow)' : 'var(--green)'}">${val.missing_after}</td>
                <td>${val.method}</td>
                <td style="color:${fixed || val.missing_before === 0 ? 'var(--green)' : 'var(--yellow)'}">
                    ${val.missing_before === 0 ? '‚úî Clean' : fixed ? '‚úî Fixed' : '‚ö† Remaining'}
                </td>
            </tr>
        `;
    });
}

// =====================================================
//  STRUCTURE
// =====================================================
function renderStructure(d) {
    document.getElementById('dfInfo').textContent = d.dataset_info;

    const tbody = document.getElementById('nuniqBody');
    tbody.innerHTML = '';
    const rows = d.overview.rows;

    Object.entries(d.nunique).forEach(([col, cnt]) => {
        const card = cnt === rows ? 'Likely ID' : cnt <= 2 ? 'Binary' : cnt <= 10 ? 'Low' : cnt <= 50 ? 'Medium' : 'High';
        tbody.innerHTML += `
            <tr>
                <td style="font-family:var(--font-mono);font-size:11px;color:var(--accent)">${col}</td>
                <td>${cnt}</td>
                <td><span class="badge">${card}</span></td>
            </tr>
        `;
    });
}

// =====================================================
//  VALUE COUNTS
// =====================================================
function renderValueCounts(d) {
    const sel = document.getElementById('vcColSelect');
    sel.innerHTML = '';

    Object.keys(d.value_counts).forEach(col => {
        sel.innerHTML += `<option value="${col}">${col}</option>`;
    });

    sel.addEventListener('change', () => fillVCTable(d, sel.value));
    if (sel.options.length > 0) fillVCTable(d, sel.options[0].value);
}

function fillVCTable(d, col) {
    const counts = d.value_counts[col];
    const total = Object.values(counts).reduce((a,b) => a + b, 0);
    const tbody = document.getElementById('vcBody');
    tbody.innerHTML = '';
    document.getElementById('vcTitle').textContent = `Value Distribution ‚Äî ${col}`;

    Object.entries(counts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 50)
        .forEach(([val, cnt]) => {
            const pct = total > 0 ? ((cnt / total) * 100).toFixed(1) : 0;
            tbody.innerHTML += `
                <tr>
                    <td>${val}</td>
                    <td>${cnt.toLocaleString()}</td>
                    <td style="color:var(--text-dim)">${pct}%</td>
                </tr>
            `;
        });
}

// =====================================================
//  CHART BUILDER
// =====================================================
function renderChartBuilder(d) {
    const xSel = document.getElementById('xAxisCol');
    const ySel = document.getElementById('yAxisCol');

    xSel.innerHTML = '';
    ySel.innerHTML = '<option value="count">Count (auto)</option>';

    const allCols = [...d.overview.numeric_columns, ...d.overview.categorical_columns];
    allCols.forEach(col => {
        xSel.innerHTML += `<option value="${col}">${col}</option>`;
        ySel.innerHTML += `<option value="${col}">${col}</option>`;
    });

    document.getElementById('buildChartBtn').addEventListener('click', () => buildChart(d));
}

function buildChart(d) {
    const type  = activeChartType;
    const xCol  = document.getElementById('xAxisCol').value;
    const yCol  = document.getElementById('yAxisCol').value;
    const title = document.getElementById('chartTitle').value || xCol;

    document.getElementById('chartDisplayTitle').textContent = title;

    if (mainChart) mainChart.destroy();

    const colors = generateColors(30);
    const ctx = document.getElementById('mainChart').getContext('2d');

    // Histogram
    if (type === 'histogram') {
        const histData = d.visualization.histograms[xCol];
        if (!histData) { toast('‚ö† SELECT A NUMERIC COLUMN'); return; }

        mainChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: histData.bins.map(b => Number(b).toFixed(1)),
                datasets: [{ label: xCol, data: histData.counts, backgroundColor: 'rgba(0,229,255,0.5)', borderColor: 'rgba(0,229,255,0.8)', borderWidth: 1, borderRadius: 2 }]
            },
            options: chartOptions(title)
        });
        return;
    }

    // Scatter
    if (type === 'scatter') {
        if (!d.preview || yCol === 'count') { toast('‚ö† SELECT BOTH X AND Y COLUMNS'); return; }
        const pts = d.preview.map(row => ({ x: row[xCol], y: row[yCol] })).filter(p => p.x != null && p.y != null);
        mainChart = new Chart(ctx, {
            type: 'scatter',
            data: { datasets: [{ label: `${xCol} vs ${yCol}`, data: pts, backgroundColor: 'rgba(124,77,255,0.6)', pointRadius: 5 }] },
            options: chartOptions(title)
        });
        return;
    }

    // Categorical bar / line / pie / doughnut / radar
    const vc = d.value_counts[xCol];
    if (!vc) {
        // If numeric, use histogram bins as fallback
        const histData = d.visualization.histograms[xCol];
        if (histData) {
            mainChart = new Chart(ctx, {
                type: type === 'line' ? 'line' : 'bar',
                data: {
                    labels: histData.bins.map(b => Number(b).toFixed(1)),
                    datasets: [{ label: xCol, data: histData.counts, backgroundColor: colors[0], borderColor: colors[0] }]
                },
                options: chartOptions(title)
            });
        } else {
            toast('‚ö† NO DATA FOR SELECTED COLUMN');
        }
        return;
    }

    const sorted = Object.entries(vc).sort((a,b) => b[1]-a[1]).slice(0, 30);
    const labels = sorted.map(e => e[0]);
    const vals   = sorted.map(e => e[1]);

    const chartType = ['pie','doughnut','radar'].includes(type) ? type : type;

    mainChart = new Chart(ctx, {
        type: chartType,
        data: {
            labels,
            datasets: [{
                label: xCol,
                data: vals,
                backgroundColor: colors,
                borderColor: type === 'line' ? colors[0] : colors,
                borderWidth: type === 'line' ? 2 : 1,
                fill: type === 'line'
            }]
        },
        options: chartOptions(title)
    });
}

function generateColors(n) {
    const palette = [
        'rgba(0,229,255,0.7)',  'rgba(124,77,255,0.7)', 'rgba(255,107,53,0.7)',
        'rgba(0,230,118,0.7)',  'rgba(255,215,64,0.7)', 'rgba(255,82,82,0.7)',
        'rgba(64,196,255,0.7)', 'rgba(197,17,98,0.7)',  'rgba(0,191,165,0.7)',
        'rgba(255,171,64,0.7)'
    ];
    const out = [];
    for (let i = 0; i < n; i++) out.push(palette[i % palette.length]);
    return out;
}

function chartOptions(title) {
    return {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { labels: { color: '#7986a3', font: { family: 'DM Sans', size: 12 } } },
            title: { display: !!title, text: title, color: '#e8eaf6', font: { family: 'Space Mono', size: 13 } }
        },
        scales: {
            x: { ticks: { color: '#7986a3', font: { size: 11 } }, grid: { color: 'rgba(37,45,61,0.6)' } },
            y: { ticks: { color: '#7986a3', font: { size: 11 } }, grid: { color: 'rgba(37,45,61,0.6)' } }
        }
    };
}

// =====================================================
//  CORRELATION
// =====================================================
function renderCorrelation(d) {
    const corr = d.advanced_visualization?.correlation;
    if (!corr || !Object.keys(corr).length) {
        document.getElementById('correlationTable').innerHTML = '<p style="color:var(--text-dim)">No numeric columns found for correlation.</p>';
        return;
    }

    const cols = Object.keys(corr);

    // HTML table
    let html = '<table><thead><tr><th></th>';
    cols.forEach(c => html += `<th>${c}</th>`);
    html += '</tr></thead><tbody>';

    cols.forEach(row => {
        html += `<tr><td style="font-family:var(--font-mono);font-size:11px;color:var(--accent)">${row}</td>`;
        cols.forEach(col => {
            const val = corr[row][col] ?? 0;
            const abs = Math.abs(val);
            const color = val >= 0.7 ? 'var(--green)' : val >= 0.3 ? 'var(--yellow)' : abs >= 0.7 ? 'var(--red)' : 'var(--text-dim)';
            html += `<td style="color:${color};font-family:var(--font-mono);font-size:11px">${val.toFixed(2)}</td>`;
        });
        html += '</tr>';
    });
    html += '</tbody></table>';
    document.getElementById('correlationTable').innerHTML = html;

    // Bar chart ‚Äî first column correlations
    const firstCol = cols[0];
    const labels   = cols.filter(c => c !== firstCol);
    const vals     = labels.map(c => corr[firstCol][c] ?? 0);

    if (corrChart) corrChart.destroy();
    corrChart = new Chart(
        document.getElementById('corrChart').getContext('2d'),
        {
            type: 'bar',
            data: {
                labels,
                datasets: [{
                    label: `Correlation with ${firstCol}`,
                    data: vals,
                    backgroundColor: vals.map(v => v >= 0 ? 'rgba(0,229,255,0.6)' : 'rgba(255,82,82,0.6)'),
                    borderRadius: 3
                }]
            },
            options: {
                ...chartOptions(`Correlation ‚Äî ${firstCol}`),
                scales: {
                    ...chartOptions('').scales,
                    y: { ...chartOptions('').scales.y, min: -1, max: 1 }
                }
            }
        }
    );
}

// =====================================================
//  INSIGHTS
// =====================================================
function renderInsights(d) {
    const box = document.getElementById('insightsBox');
    box.innerHTML = '';
    d.insights.forEach(insight => {
        box.innerHTML += `
            <div class="insight-item">
                <div class="insight-dot"></div>
                <span>${insight}</span>
            </div>
        `;
    });
}

// =====================================================
//  PREVIEW
// =====================================================
function renderPreview(d) {
    const div = document.getElementById('previewTable');
    if (!d.preview?.length) { div.innerHTML = '<p>No preview available.</p>'; return; }

    const cols = Object.keys(d.preview[0]);
    let html = '<table><thead><tr>';
    cols.forEach(c => html += `<th>${c}</th>`);
    html += '</tr></thead><tbody>';
    d.preview.forEach(row => {
        html += '<tr>';
        cols.forEach(c => html += `<td>${row[c] ?? ''}</td>`);
        html += '</tr>';
    });
    html += '</tbody></table>';
    div.innerHTML = html;
}

// =====================================================
//  VALUE COUNTS NAV UPDATE ON RENDER
// =====================================================
document.getElementById('vcColSelect').addEventListener('change', () => {
    if (G) fillVCTable(G, document.getElementById('vcColSelect').value);
});
</script>

</body>
</html>
